---
title: "è³ªçš„ãƒ‡ãƒ¼ã‚¿ã®å‡ºç¾é »åº¦"
jupyter: python3
author: "Ryo Nakagami"
date: "2025-04-14"
date-modified: last-modified
comments:
    utterances:
         repo: RyoNakagami/statistics-for-regression-monkey
         label: discussion
# when you run this file locally, do not forget to run poetry shell
---

## å•é¡Œè¨­å®š

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚«ãƒ†ã‚´ãƒªåˆ¥å‡ºç¾é »åº¦ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ã—ã¾ã™ï¼

- `faulty_component`: æ•…éšœç®‡æ‰€
- `faulty_category`: æ•…éšœå†…å®¹ã«å¿œã˜ãŸåˆ†é¡
- `count`: å‡ºç¾é »åº¦

```{python}
import pandas as pd


data = {
    "faulty_component": [
        "ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯", "ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯",
        "ãƒ¡ãƒ¢ãƒª", "ãƒ¡ãƒ¢ãƒª",
        "é›»æºãƒ¦ãƒ‹ãƒƒãƒˆ", "é›»æºãƒ¦ãƒ‹ãƒƒãƒˆ",
        "ãƒ•ã‚¡ãƒ³", "ãƒã‚¶ãƒ¼ãƒœãƒ¼ãƒ‰",
        "æ¶²æ™¶ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤", "æ¶²æ™¶ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤",
        "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢", "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢"
    ],
    "faulty_category": [
        "æ¥ç¶šä¸è‰¯", "ç•°éŸ³",
        "èµ·å‹•ä¸è‰¯", "ãƒ–ãƒ«ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³",
        "é›»æºä¸å®‰å®š", "é›»æºä¸è‰¯",
        "ç•°éŸ³", "æ¥ç¶šä¸è‰¯",
        "ç”»é¢ä¸èªè­˜", "è¡¨ç¤ºãƒˆãƒ©ãƒ–ãƒ«",
        "èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼", "ã‚¢ãƒ—ãƒªå¼·åˆ¶çµ‚äº†"
    ],
    "count": [125, 87, 73, 52, 64, 91, 40, 38, 70, 33, 49, 58]
}

df = pd.DataFrame(data)
df
```



### å¯è¦–åŒ–æ–¹é‡

::: {.callout-note}

### è¦ä»¶

:::{.regmonkey-approach}

1. è¤‡æ•°ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã‚’çµåˆã—ã¦ç”Ÿæˆã—ãŸãƒ©ãƒ™ãƒ«å¤‰æ•°ã‚’keyï¼Œå‡ºç¾é »åº¦ã‚’valueã¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ï¼Œå‡ºç¾é »åº¦ã‚’bar plot, ç´¯ç©é »åº¦ã‚’line plotã¨ã—ã¦å¯è¦–åŒ–
2. 2ã¤ã®ã‚«ãƒ†ã‚´ãƒªæ¬¡å…ƒã«ã‚ãŸã‚‹å€¤ã®é »åº¦åˆ†å¸ƒã‚’heatmapã‚’ç”¨ã„ã¦å¯è¦–åŒ–

:::
:::



ä»¥ä¸Šã®ï¼’ã¤ã‚’å¯è¦–åŒ–å®Ÿè£…ã‚’å–ã‚Šæ‰±ã„ã¾ã™ãŒï¼Œå®Ÿè£…èª¬æ˜ã®å‰ã«EDAã¨ã—ã¦ã©ã®ã‚ˆã†ãªstory-tellingãŒè€ƒãˆã‚‰ã‚Œã‚‹ã‹ç´¹ä»‹ã—ã¾ã™ï¼

<!--::: {.callout-note collapse="true" icon=false}-->
::: {.callout-note collapse="false" icon=false}
## ãƒ‘ãƒ¬ãƒ¼ãƒˆå›³åˆ†æsummaryä¾‹ 

::: {#exm- .custom_problem }
<br>

|||
|---|---|
|åˆ†æãƒ†ãƒ¼ãƒ|ç„¡æ•°ã«ã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹æ•…éšœã®ã†ã¡ï¼Œå®Ÿéš›ã«å¯¾å¿œã™ã¹ãã¯ã”ãä¸€éƒ¨ã®ä»£è¡¨çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãªã®ã§ã¯ãªã„ã‹ï¼Ÿ|
|å¯è¦–åŒ–è§£é‡ˆ|ã‚«ãƒ†ã‚´ãƒªçµ„ã¿åˆã‚ã›ã¯ç„¡æ•°ã«ã‚ã‚‹ãŒï¼ŒTop 10ã ã‘ã§ã‚‚ç•°å¸¸ç™ºç”Ÿä»¶æ•°å…¨ä½“ã® 80%ã‚’ã—ã‚ã¦ãŠã‚Šï¼ŒTop 10ã®ã¿ã«é›†ä¸­ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã¨ã‚‹ã¹ã|
|ã‚¤ãƒ³ã‚µã‚¤ãƒˆ|ãƒªã‚½ãƒ¼ã‚¹ã‚’åºƒãåˆ†æ•£ã™ã‚‹ã®ã§ã¯ãªãï¼Œã€Œãƒ•ã‚¡ãƒ³-å‹•ä½œä¸è‰¯ã€ã€ŒHDD-èªè­˜ä¸èƒ½ã€ãªã©ï¼Œé »åº¦ã®é«˜ã„ã‚«ãƒ†ã‚´ãƒªã«çµã£ã¦æ”¹å–„ç­–ãƒ»å“è³ªå¯¾ç­–ãƒ»éƒ¨å“è¦‹ç›´ã—ãƒ»è£½é€ å·¥ç¨‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨ãŒï¼Œæœ€ã‚‚ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã„æ”¹å–„ã«ãªã‚‹|

: {tbl-colwidths="[20, 80]"}

:::

<br>

::: {#exm- .custom_problem }
<br>

|||
|---|---|
|åˆ†æãƒ†ãƒ¼ãƒ|æ•…éšœã‚«ãƒ†ã‚´ãƒªã®å•é¡ŒãŒã‚ã‚‹ãŸã‚æ•…éšœé »åº¦åˆ†å¸ƒã¯è£¾ã®åšã„åˆ†å¸ƒæ‹…ã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã‹ï¼Ÿ|
|å¯è¦–åŒ–è§£é‡ˆ|ã‚«ãƒ†ã‚´ãƒªçµ„ã¿åˆã‚ã›Top 10ã«çµã£ã¦ã‚‚ç´¯ç©æ•…éšœå‰²åˆã¯å…¨ä½“ã®40%ã‚’å ã‚ã‚‹ã«ã¨ã©ã¾ã£ã¦ãŠã‚Šï¼Œæ•…éšœã‚«ãƒ†ã‚´ãƒªã¯è£¾ã®åšã„(fat-tailed)åˆ†å¸ƒã¨è¦‹ãˆã‚‹ï¼<br><br>æ•…éšœã‚«ãƒ†ã‚´ãƒªåˆ†é¡ã«ã¤ã„ã¦ä¸€éƒ¨ç²’åº¦ãŒç´°ã‹ã™ãã‚‹ãŸã‚è£¾ãŒåšããªã£ã¦ã—ã¾ã£ãŸã¨ä»®èª¬ç«‹ã¦ï¼Œè£œä¿®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¦³ç‚¹ã‚’è¸ã¾ãˆã¦ã‚«ãƒ†ã‚´ãƒªã‚’å†å®šç¾©ã—ãŸä¸Šã§é›†è¨ˆã—ç›´ã—ãŸã¨ã“ã‚ï¼ŒTop10ã‚«ãƒ†ã‚´ãƒªã§å…¨ä½“ã®ç´„75%ã‚’ã‚«ãƒãƒ¼ã™ã‚‹æ§‹é€ ãŒæµ®ã‹ã³ä¸ŠãŒã£ãŸï¼(=**fat-tailed åˆ†å¸ƒã®è¦‹ãˆæ–¹ã¯ï¼Œåˆ†é¡è¨­è¨ˆãã®ã‚‚ã®ã®æ­ªã¿ã‚’ç¤ºã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**)|
|ã‚¤ãƒ³ã‚µã‚¤ãƒˆ|æ•…éšœãƒ­ã‚°ã®åˆ†é¡è¨­è¨ˆã«ã¯ï¼Œå®Ÿéš›ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„å¯¾å¿œãƒ•ãƒ­ãƒ¼ã¨ã®æ•´åˆæ€§ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒé‡è¦<br><br>å†å®šç¾©ã—ãŸã‚«ãƒ†ã‚´ãƒªã‚’æ¨™æº–åˆ†é¡ã¨ã—ï¼Œç¶™ç¶šçš„ãªåˆ†æã«æ´»ç”¨ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã‚’æ•´å‚™ã™ã‚‹å¿…è¦æ€§ã‚ã‚Š|


: {tbl-colwidths="[20, 80]"}

:::

:::


<!--::: {.callout-note collapse="true" icon=false}-->
::: {.callout-note collapse="false" icon=false}
## heatmapåˆ†æsummaryä¾‹

::: {#exm- .custom_problem }
<br>

|||
|---|---|
|åˆ†æãƒ†ãƒ¼ãƒ|æ•…éšœç®‡æ‰€ Ã— æ•…éšœå†…å®¹ã®çµ„ã¿åˆã‚ã›é »åº¦ã«åã‚ŠãŒå­˜åœ¨ã™ã‚‹ã‹ã‚’ç¢ºèªã—ï¼Œé‡ç‚¹å¯¾å¿œã™ã¹ãã‚«ãƒ†ã‚´ãƒªã‚’ç‰¹å®šã™ã‚‹|
|å¯è¦–åŒ–è§£é‡ˆ|æ•…éšœç®‡æ‰€ã¨æ•…éšœå†…å®¹ã®çµ„ã¿åˆã‚ã›ã‚’2è»¸ã«ã¨ã£ãŸãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’ä½œæˆã—ãŸã¨ã“ã‚ï¼Œç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä»¶æ•°ãŒæ¥µç«¯ã«é›†ä¸­ã—ã¦ã„ã‚‹æ§‹é€ ãŒæ˜ã‚‰ã‹ã«ãªã£ãŸ<br><br>ãŸã¨ãˆã°ï¼Œã€ŒHDD Ã— èªè­˜ä¸èƒ½ã€ã‚„ã€Œãƒ•ã‚¡ãƒ³ Ã— å‹•ä½œä¸è‰¯ã€ã¨ã„ã£ãŸä¸€éƒ¨ã®çµ„ã¿åˆã‚ã›ã‚»ãƒ«ãŒå¼·èª¿ã•ã‚Œï¼Œãã®ä»–å¤šãã®ã‚»ãƒ«ãŒæ¥µç«¯ã«ä»¶æ•°ã®å°‘ãªã„çŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ï¼Œæ•…éšœãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé™å®šçš„ã§ã‚ã‚‹ã“ã¨ãŒè¦–è¦šçš„ã«ç¤ºã•ã‚ŒãŸ|
|ã‚¤ãƒ³ã‚µã‚¤ãƒˆ|æ•…éšœã¯ä¸€è¦‹ãƒãƒ©ãƒãƒ©ã«ç™ºç”Ÿã—ã¦ã„ã‚‹ã‚ˆã†ã§ã„ã¦ï¼Œå®Ÿéš›ã«ã¯é™ã‚‰ã‚ŒãŸæ•°ã®å…¸å‹çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«é›†ä¸­çš„ã«ç™ºç”Ÿã—ã¦ã„ã‚‹|

: {tbl-colwidths="[20, 80]"}

:::

<br>

::: {#exm- .custom_problem }
<br>

|||
|---|---|
|åˆ†æãƒ†ãƒ¼ãƒ|æ•…éšœç®‡æ‰€ Ã— æ•…éšœå†…å®¹ã®çµ„ã¿åˆã‚ã›ã®ä¸­ã§ï¼Œä¸€è¦‹ç›®ç«‹ãŸãªã„ãŒç›¸å¯¾çš„ã«ç•°å¸¸é »åº¦ãŒé«˜ã„â€œéš ã‚Œãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆâ€ã‚’å¯è¦–åŒ–ã™ã‚‹|
|å¯è¦–åŒ–è§£é‡ˆ|æ•…éšœãƒ­ã‚°å…¨ä½“ã‚’ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§ä¿¯ç°ã—ãŸçµæœï¼Œå…¨ä½“ä»¶æ•°ã§ã¯ä¸Šä½ã«å…¥ã‚‰ãªã„ã‚«ãƒ†ã‚´ãƒªã®ä¸­ã«ã‚‚ï¼Œç‰¹å®šã®æ•…éšœå†…å®¹ã«åã£ãŸç•°å¸¸ç™ºç”ŸãŒé›†ä¸­ã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ã«ãªã£ãŸ<br><br>ã€Œé›»æºãƒ¦ãƒ‹ãƒƒãƒˆ Ã— ç•°éŸ³ã€ã‚„ã€Œãƒ¡ãƒ¢ãƒª Ã— æ¥è§¦ä¸è‰¯ã€ãªã©ï¼Œãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ã¯ç›®ç«‹ãŸãªã„ã‚‚ã®ã®ï¼Œä»–ã®æ•…éšœå†…å®¹ã¨æ¯”è¼ƒã™ã‚‹ã¨æ˜ã‚‰ã‹ã«â€œæµ®ã„ã¦ã„ã‚‹â€ã‚»ãƒ«ãŒå­˜åœ¨ã—ã¦ã„ãŸ|
|ã‚¤ãƒ³ã‚µã‚¤ãƒˆ|ä»Šå¾Œã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã§ã¯ï¼Œä»¶æ•°ãŒå°‘ãªãã¦ã‚‚æ¥µç«¯ãªåã‚Šã‚’ç¤ºã™â€œç•°å¸¸ã«æ¿ƒã„ã‚»ãƒ«â€ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ï¼Œç‚¹æ¤œå¯¾è±¡ã®è¦‹ç›´ã—ã‚„ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ã®å†è¨­è¨ˆã‚’æ¤œè¨ã™ã¹ã|

: {tbl-colwidths="[20, 80]"}

:::




:::









## å¯è¦–åŒ–å®Ÿè£…1: ãƒ‘ãƒ¬ãƒ¼ãƒˆå›³

<strong > &#9654;&nbsp; å‰å‡¦ç†</strong>

å‡ºç¾é »åº¦ã®ã‚«ãƒ©ãƒ ã‚’ç”¨ã„ã¦äº‹å‰ã« `descending sort` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿæ–½ã—ã¾ã™ï¼


```{python}
#| code-fold: show
df_sorted = df.sort_values(by="count", ascending=False).reset_index(drop=True)
df_sorted["cum_percent"] = df_sorted["count"].cumsum() / df_sorted["count"].sum()
df_sorted["label"] = df_sorted["faulty_component"].astype(str) + "-" + df_sorted["faulty_category"].astype(str)
df_sorted.head()
```

<br>
<strong > &#9654;&nbsp; å¼•æ•°ãƒ†ãƒ¼ãƒ–ãƒ«</strong>

|å¼•æ•°|èª¬æ˜|
|---|---|
|`data`|ã‚«ãƒ†ã‚´ãƒªï¼Œä»¶æ•°ï¼Œç´¯ç©å€¤ã‚’å«ã‚€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ï¼cumulative plotãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã«ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹|
|`category_column`| xè»¸ã«ä½¿ç”¨ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªåˆ—ã®åå‰|
|`count_column`| æ£’ã‚°ãƒ©ãƒ•ï¼ˆä¸»è»¸ï¼‰ã«ä½¿ç”¨ã™ã‚‹ä»¶æ•°åˆ—ã®åå‰|
|`cumulative_column`|line plot(y2-axis)ã«ä½¿ç”¨ã™ã‚‹ç´¯ç©å€¤ï¼ˆä¾‹ï¼šãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰ã®åˆ—ã®åå‰|
|`xaxis_name`| : xè»¸ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`y1_axis_name`| `y1-axis`ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`y2_axis_name`| `y2-axis`ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`y1_label`| bar plotã®legendãƒ©ãƒ™ãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`y2_label`| cumulative plotã®legendãƒ©ãƒ™ãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`figure_title`| å›³å…¨ä½“ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `""`|
|`figsize`|`matplotlib`ç”¨ã®figure sizeè¨­å®šå€¤(`tuple`)|

: Args {tbl-colwidths="[20, 80]"}

<br>
<strong > &#9654;&nbsp; `Plotly` ã‚’ç”¨ã„ãŸå¯è¦–åŒ–</strong>


```{python}
# | code-fold: show
import plotly.graph_objects as go


def plot_category_frequency_plotly(
    data: pd.DataFrame,
    category_column: str,
    count_column: str,
    cumulative_column: str,
    xaxis_name: str = "",
    y1_axis_name: str = "",
    y2_axis_name: str = "",
    y1_label: str = "",
    y2_label: str = "",
    figure_title: str = "",
) -> go.Figure:
    """
    - ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ä»¶æ•°ã‚’æ£’ã‚°ãƒ©ãƒ•ã§ï¼Œç´¯ç©å€¤ï¼ˆä¾‹ï¼šç´¯ç©ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰ã‚’æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–ã™ã‚‹Plotlyå›³ã‚’ç”Ÿæˆ
    - cumulative plotãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã«ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
    """
    # create bar trace
    bar = go.Bar(
        x=data[category_column],
        y=data[count_column],
        name=y1_label,
        yaxis="y1",
        marker=dict(color="#6699CC"),
    )

    # Create cumulative line trace
    line = go.Scatter(
        x=data[category_column],
        y=data[cumulative_column],
        name=y2_label,
        yaxis="y2",
        mode="lines+markers",
        line=dict(color="#000000", dash="dot"),
    )

    # Layout
    layout = go.Layout(
        title=dict(
            text=figure_title,
            x=0.,
            xanchor="left",
            yanchor="top",
        ),
        margin=dict(t=50),
        xaxis=dict(title=xaxis_name, tickangle=45),
        yaxis=dict(title=y1_axis_name),
        yaxis2=dict(
            title=y2_axis_name,
            overlaying="y",
            side="right",
            range=[0, 1.1],
            gridcolor="#EFF5F5",
        ),
        legend=dict(x=1.05, y=1.0, orientation="v"),
    )

    # Plot
    fig = go.Figure(data=[bar, line], layout=layout).update_layout(
        {"plot_bgcolor": "#EFF5F5", "yaxis": {"gridcolor": "#EFF5F5"}}
    )

    return fig
```

å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ï¼Œ

```{python}
#| code-fold: show
fig = plot_category_frequency_plotly(
    data=df_sorted,
    category_column="label",
    count_column="count",
    cumulative_column="cum_percent",
    xaxis_name="Faulty Category",
    y1_axis_name="Frequency",
    y2_axis_name="Cumulative Percentage",
    y1_label="ä»¶æ•°",
    y2_label="ç´¯ç©å‰²åˆ",
    figure_title="PC Faulty component frequency",
)
fig.show()
```

<br>
<strong > &#9654;&nbsp; `matplotlib` ã‚’ç”¨ã„ãŸå¯è¦–åŒ–</strong>

```{python}
#| code-fold: show
import matplotlib.pyplot as plt


def plot_category_frequency_matplotlib(
    data: pd.DataFrame,
    category_column: str,
    count_column: str,
    cumulative_column: str,
    xaxis_name: str = "",
    y1_axis_name: str = "",
    y2_axis_name: str = "",
    y1_label: str = "",
    y2_label: str = "",
    figure_title: str = "",
    figsize: tuple = (8, 6),
):
    fig, ax1 = plt.subplots(figsize=figsize)
    ax1.set_facecolor("#EFF5F5")  # ğŸ‘ˆ plot background color

    # Bar plot on primary y-axis
    bars = ax1.bar(
        data[category_column], data[count_column], color="#6699CC", label=y1_label
    )
    ax1.set_ylabel(y1_axis_name, fontsize=12)
    ax1.set_xlabel(xaxis_name, fontsize=12)
    ax1.tick_params(axis="y")

    # Line plot on secondary y-axis
    ax2 = ax1.twinx()
    line = ax2.plot(
        data[category_column],
        data[cumulative_column],
        color="#000000",
        linestyle="dotted",
        marker="o",
        label=y2_label,
    )
    ax2.set_ylabel(y2_axis_name, fontsize=12)
    ax2.set_ylim(0, 1.1)
    ax2.tick_params(axis="y")
    plt.setp(ax1.get_xticklabels(), rotation=(360-45), ha="left")  # ğŸ‘ˆ Rotate x-axis labels
    
    # Title and legend
    fig.suptitle(figure_title, x=0.0, ha="left", fontsize=14)

    # Combine legends from both axes
    lines_labels = [*ax1.get_legend_handles_labels(), *ax2.get_legend_handles_labels()]
    fig.legend(loc="upper left", bbox_to_anchor=(0.925, 0.925))
    fig.patch.set_facecolor("#FFFFFF")

    plt.tight_layout()
    return fig, ax1, ax2

```

å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ï¼Œ

```{python}
# | code-fold: show

from regmonkey_style import stylewizard as sw

# japanese language setup
sw.set_font("IPAexGothic")


fig, ax1, ax2 = plot_category_frequency_matplotlib(
    data=df_sorted,
    category_column="label",
    count_column="count",
    cumulative_column="cum_percent",
    xaxis_name="Faulty Category",
    y1_axis_name="Frequency",
    y2_axis_name="Cumulative Percentage",
    y1_label="ä»¶æ•°",
    y2_label="ç´¯ç©å‰²åˆ",
    figure_title="PC Faulty component frequency",
)
plt.show()
```

## å¯è¦–åŒ–å®Ÿè£…2: heatmap

- ã“ã“ã§ã¯ï¼Œxaxis, yaxisã¨ãªã‚‹ï¼’ã¤ã®ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã‚’ç”¨ã„ã¦pivot tableã‚’ä½œæˆã—ï¼Œãã‚Œã‚’heatmapã§å¯è¦–åŒ–
- pivotã«ã‚ãŸã£ã¦ã®é›†è¨ˆé–¢æ•°ã¯ `sum` ã‚’ç”¨ã„ã‚‹
- `NaN`ï¼ˆæ¬ æå€¤ï¼‰ã¯ãƒ—ãƒ­ãƒƒãƒˆå‰ã«0ã§è£œå®Œ
- `"PuBu"` ã‚«ãƒ©ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨

<strong > &#9654;&nbsp; å®Ÿè£…</strong>

```{python}
# | code-fold: show
import seaborn as sns


def heatmap_frequency(
    data: pd.DataFrame,
    xaxis_column: str,
    yaxis_column: str,
    value_column: str,
    x_axis_name: str = "",
    y_axis_name: str = "",
    figure_title: str = "",
    plot_type = 'plotly',
    figsize = (10, 6)
):
    table = pd.pivot_table(
        data,
        values=value_column,
        index=[yaxis_column],
        columns=[xaxis_column],
        aggfunc="sum",
    ).fillna(0)

    if plot_type == 'plotly':
        fig = go.Figure(
            data=go.Heatmap(
                z=table.values,
                x=table.columns,  # Optional: x-axis labels
                y=table.index,  # Optional: y-axis labels
                colorscale="PuBu",  # You can try: 'Blues', 'Hot', 'Cividis', etc.
            )
        )

        fig.update_layout(
            title=figure_title, xaxis_title=x_axis_name, yaxis_title=y_axis_name
            
        )

        return fig
    
    else:
         # Create the plot
        fig, ax = plt.subplots(figsize=figsize)

        sns.heatmap(
            table.values,
            xticklabels=table.columns,
            yticklabels=table.index,
            cmap="PuBu",
            ax=ax
        )

        ax.set_xlabel(x_axis_name)
        ax.set_ylabel(y_axis_name)
        ax.set_title(figure_title, loc="center")

        plt.xticks(rotation=(360-45), ha='left')
        plt.yticks(rotation=0)

        plt.tight_layout()
        return fig, ax

```

<strong > &#9654;&nbsp; `Plotly` ã«ã‚ˆã‚‹å¯è¦–åŒ–</strong>

```{python}
fig = heatmap_frequency(
    data=df_sorted,
    xaxis_column="faulty_category",
    yaxis_column="faulty_component",
    value_column="count",
    x_axis_name="æ•…éšœã‚«ãƒ†ã‚´ãƒª",
    y_axis_name="æ•…éšœç®‡æ‰€",
    figure_title=dict(
        text="æ•…éšœåˆ†å¸ƒ",
        font=dict(size=18),
        automargin=True,
        x=0.5,  # Center title
        y=0.95,
        xanchor="center",
    ),
)


fig.show()
```

<strong > &#9654;&nbsp; `matplotlib` ã«ã‚ˆã‚‹å¯è¦–åŒ–</strong>

```{python}
fig, ax = heatmap_frequency(
    data=df_sorted,
    xaxis_column='faulty_category',
    yaxis_column='faulty_component',
    value_column='count',
    x_axis_name='æ•…éšœã‚«ãƒ†ã‚´ãƒª',
    y_axis_name='æ•…éšœç®‡æ‰€',
    figure_title='æ•…éšœåˆ†å¸ƒ',
    plot_type = 'matplotlib',
)

plt.show()
```